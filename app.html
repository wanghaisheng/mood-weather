<html><head><base href="moodweather.heytcm.com/app" /><style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

.mobile-container {
  position: relative;
  width: 375px;
  height: 812px;
  margin: 20px auto;
  border-radius: 40px;
  overflow: hidden;
  background-image: url("images/default/rQ7Hi42JQ1S7cay9H-655w.webp");
  background-size: cover;
  background-position: center;
  box-shadow: 0 0 20px rgba(0,0,0,0.3);
  transition: background-image 0.5s ease;
}

.mobile-container.monday {
  background-image: url("images/happy/Pks4jgnzQ_yfiJJ9OSZ7lQ.jpg");
}

.mobile-container.thursday {

  background-image: url("images/sad/fgCzi4ttRbyA4ehkxCdPqw.webp");
}

.mobile-container.wedsday {
  background-image: url("images/angry/lgJRZIbxRBmkp5asEUJweA.webp");
}

  .mobile-container.friday {
    background-image: url("images/default/rQ7Hi42JQ1S7cay9H-655w.webp");
  }


.mobile-container.today {
  background-image: url("images/happy/CmmhL2ODSkeDs9FyPr_bNQ.webp");
}

.monday .location,
.monday .temperature,
.monday .weather-description,
.monday .detail-label,
.monday .detail-value,
.monday .forecast-day,
.monday .forecast-temp,
.monday .hourly-time,
.monday .hourly-temp,
.monday h3 {
  color: #fff !important;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.8) !important;
}

.notch {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 200px;
  height: 30px;
  background: #000;
  border-bottom-left-radius: 20px;
  border-bottom-right-radius: 20px;
  z-index: 100;
}

.status-bar {
  position: absolute;
  top: 5px;
  width: 100%;
  padding: 0 20px;
  display: flex;
  justify-content: space-between;
  color: #333;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 12px;
  z-index: 101;
}

.time {
  font-weight: bold;
}

.status-icons {
  display: flex;
  gap: 5px;
}

.home-indicator {
  position: absolute;
  bottom: 5px;
  left: 50%;
  transform: translateX(-50%);
  width: 140px;
  height: 5px;
  background: #333;
  border-radius: 3px;
  z-index: 100;
}

.content {
  height: 100%;
  padding: 40px 20px;
  padding-top: 80px;
  color: #333;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  overflow-y: auto;
}

.location {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 24px;
  margin-bottom: 10px;
  color: #222;
  text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
}

.temperature {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 64px;
  font-weight: 200;
  margin: 20px 0;
  color: #222;
  text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
}

.weather-icon {
  width: 120px;
  height: 120px;
}

.forecast {
  display: flex;
  justify-content: space-between;
  margin-top: 30px;
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 15px;
}

.forecast-item {
  text-align: center;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

.forecast-day {
  font-size: 14px;
  opacity: 0.8;
  margin-bottom: 5px;
}

.forecast-temp {
  font-size: 18px;
}

.hourly-forecast {
  margin: 20px 0;
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 15px;
}

.hourly-scroll {
  display: flex;
  overflow-x: auto;
  gap: 20px;
  padding: 10px 0;
  scrollbar-width: none;
}

.hourly-scroll::-webkit-scrollbar {
  display: none;
}

.hourly-item {
  flex: 0 0 auto;
  text-align: center;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

.hourly-time {
  font-size: 14px;
  opacity: 0.8;
  margin-bottom: 5px;
}

.hourly-temp {
  font-size: 18px;
  font-weight: 500;
}

@keyframes rotate {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.sun {
  animation: rotate 20s linear infinite;
}

.weather-details {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-top: 20px;
}

.detail-card {
  background: rgba(255, 255, 255, 0.9);
  border-radius: 15px;
  padding: 15px;
  text-align: left;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

.detail-label {
  font-size: 12px;
  opacity: 0.8;
  color: #444;
}

.detail-value {
  font-size: 18px;
  margin-top: 5px;
  color: #222;
}

.weather-info {
  text-align: center;
  margin-top: 20px;
}

.add-button {
  position: absolute; 
  bottom: 80px;
  right: 20px;
  width: 50px;
  height: 50px;
  background: #007AFF;
  border-radius: 25px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 24px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  cursor: pointer;
  z-index: 1000;
}

.voice-container {
  margin-top: 15px;
  padding: 15px;
}

.input-method-toggle {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.input-method-button {
  flex: 1;
  padding: 8px;
  background: #f0f0f0;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  color: #666;
}

.input-method-button.active {
  background: #007AFF;
  color: white;
}

.note-input {
  width: 100%;
  min-height: 60px;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 8px;
  font-size: 14px;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  resize: vertical;
  margin-top: 10px;
}

.note-input:focus {
  outline: none;
  border-color: #007AFF;
}

.record-button {
  width: 100%;
  padding: 10px;
  background: #FF3B30;
  color: white;
  border: none;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  cursor: pointer;
  margin-bottom: 10px;
}

.record-button.recording {
  background: #34C759;
}

.transcription-area {
  width: 100%;
  min-height: 60px;
  padding: 10px;
  background: white;
  border: 1px solid #ddd;
  border-radius: 8px;
  margin-top: 10px;
  font-size: 14px;
  color: #333;
}

.mic-icon {
  width: 20px;
  height: 20px;
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1001;
}

.modal {
  background: white;
  padding: 20px;
  border-radius: 15px;
  width: 80%;
  max-width: 300px;
  max-height: 80vh;
  overflow-y: auto;
}

.tag-group {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin: 10px 0;
}

.tag {
  background: #f0f0f0;
  padding: 8px;
  border-radius: 8px;
  text-align: center;
  cursor: pointer;
  transition: background 0.3s;
}

.tag:hover {
  background: #e0e0e0;
}

.tag.selected {
  background: #007AFF;
  color: white;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.close-button {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
}

.save-button {
  background: #007AFF;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  width: 100%;
  margin-top: 15px;
  cursor: pointer;
}

.save-button:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.breadcrumb {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}

.breadcrumb-item {
  background: #e0e0e0;
  padding: 5px 10px;
  border-radius: 15px;
  font-size: 12px;
}

.settings-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1001;
}

.setting-item {
  margin: 15px 0;
}

.language-select {
  width: 100%;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #ddd;
  margin-top: 5px;
}

.setting-item label {
  display: block;
  margin-bottom: 5px;
  color: #333;
}

.menu-button {
  position: absolute; 
  top: 60px;
  right: 20px;
  width: 40px;
  height: 40px;
  background: rgba(255, 255, 255, 0.8);
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 1000;
}

.menu-modal {
  position: absolute;
  top: 110px; 
  right: 20px;
  background: white;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  overflow: hidden;
  display: none;
  z-index: 1000;
  min-width: 150px; 
}

.radar-container {
  display: none;
  height: 100%;
  padding: 65px 15px 80px;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow-y: auto;
}

.radar-section {
  background: rgba(255, 255, 255, 0.85);
  border-radius: 20px;
  padding: 18px;
  margin-bottom: 15px;
  backdrop-filter: blur(10px);
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.radar-section h3 {
  font-size: 18px;
  font-weight: 600;
  color: #333;
  margin-bottom: 15px;
}

.reporter-map {
  width: 100%;
  height: 320px;
  border-radius: 12px;
  overflow: hidden;
  z-index: 1;
}

/* Override default Leaflet styles to match the app theme */
.leaflet-container {
  background: rgba(255, 255, 255, 0.1) !important;
}

.leaflet-control-attribution {
  background: rgba(255, 255, 255, 0.7) !important;
  font-size: 10px !important;
}

.radar-animation {
  width: 100%;
  max-width: 280px;
  height: 280px;
  margin: 10px auto;
  position: relative;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(5px);
  border: 2px solid rgba(0, 122, 255, 0.3);
  overflow: hidden;
}

@keyframes radarScan {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@keyframes radarPulse {
  0% {
    opacity: 0.8;
    transform: scale(1);
  }
  100% {
    opacity: 0;
    transform: scale(1.5);
  }
}

.radar-sweep {
  animation: radarScan 4s linear infinite;
  transform-origin: center center;
}

.radar-pulse {
  animation: radarPulse 2s ease-out infinite;
}

.radar-scanning-details {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-top: 15px;
}

.radar-detail-card {
  background: rgba(255, 255, 255, 0.7);
  padding: 12px;
  border-radius: 12px;
}

.radar-detail-label {
  font-size: 12px;
  color: #666;
  margin-bottom: 4px;
}

.radar-detail-value {
  font-size: 16px;
  font-weight: 500;
  color: #333;
}

.weather-alert {
  background: rgba(103, 58, 183, 0.08);
  border-left: 4px solid #673AB7;
  transition: all 0.3s ease;
}

.weather-alert:hover {
  transform: translateY(-2px);
  box-shadow: 0 2px 8px rgba(103, 58, 183, 0.2);
}

.alert-title {
  font-weight: 600;
  margin-bottom: 5px;
  transition: color 0.3s ease;
  color: #673AB7;
}

.alert-message {
  color: #333;
  font-size: 14px;
  line-height: 1.5;
}

.leaderboard-section {
  background: rgba(255, 255, 255, 0.85);
  border-radius: 20px;
  padding: 18px;
  backdrop-filter: blur(10px);
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.filter-controls {
  display: flex;
  gap: 8px;
  margin-bottom: 15px;
}

.filter-select {
  padding: 8px 12px;
  border-radius: 12px;
  border: 1px solid rgba(0, 122, 255, 0.2);
  background: rgba(255, 255, 255, 0.9);
  flex: 1;
  font-size: 14px;
  color: #333;
  -webkit-appearance: none;
  appearance: none;
  background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23333%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.4-12.8z%22%2F%3E%3C%2Fsvg%3E");
  background-repeat: no-repeat;
  background-position: right 12px top 50%;
  background-size: 10px auto;
}

.leaderboard-tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 15px;
  overflow-x: auto;
  padding-bottom: 5px;
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.leaderboard-tabs::-webkit-scrollbar {
  display: none;
}

.leaderboard-tab {
  padding: 8px 16px;
  background: rgba(255, 255, 255, 0.8);
  border-radius: 15px;
  white-space: nowrap;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 14px;
  border: 1px solid rgba(0, 122, 255, 0.1);
}

.leaderboard-tab.active {
  background: #007AFF;
  color: white;
  border-color: transparent;
}

.leaderboard-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid rgba(0, 0, 0, 0.06);
}

.leaderboard-item:last-child {
  border-bottom: none;
}

.friends-container {
  display: none;
  height: 100%;
  padding: 65px 15px 80px;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow-y: auto;
  background-image: inherit;
}

.map-section {
  background: rgba(255, 255, 255, 0.85);
  border-radius: 20px;
  padding: 18px;
  margin-bottom: 15px;
  backdrop-filter: blur(10px);
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.map-section h3 {
  font-size: 18px;
  font-weight: 600;
  color: #333;
  margin-bottom: 15px;
}

.map-overlay {
  position: absolute;
  bottom: 10px;
  left: 10px;
  background: rgba(255,255,255,0.9);
  padding: 8px 12px;
  border-radius: 8px;
  z-index: 1;
  font-size: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.map-legend {
  display: flex;
  align-items: center;
  gap: 10px;
}

.legend-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.legend-dot.high { 
  background: #FF453A;
}

.legend-dot.medium {
  background: #FF9F0A;
}

.legend-dot.low {
  background: #30D158;
}

.map-stat-card {
  background: rgba(255, 255, 255, 0.7);
  padding: 15px;
  border-radius: 12px;
  transition: transform 0.2s ease;
}

.map-stat-card:hover {
  transform: translateY(-2px);
}

.stat-trend {
  font-size: 12px;
  color: #30D158;
  margin-top: 4px;
}

.feed-section {
  background: rgba(255, 255, 255, 0.85);
  border-radius: 20px;
  padding: 18px;
  backdrop-filter: blur(10px);
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.feed-section h3 {
  font-size: 18px;
  font-weight: 600;
  color: #333;
  margin-bottom: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.feed-filter {
  font-size: 13px;
  color: #007AFF;
  padding: 5px 10px;
  background: rgba(0, 122, 255, 0.1);
  border-radius: 15px;
  cursor: pointer;
}

.weather-card {
  background: rgba(255, 255, 255, 0.7);
  border-radius: 15px;
  padding: 15px;
  margin-bottom: 12px;
  transition: transform 0.2s ease;
}

.weather-card:last-child {
  margin-bottom: 0;
}

.weather-card:hover {
  transform: translateY(-2px);
}

.weather-card .location {
  font-size: 16px;
  font-weight: 600;
  color: #333;
  margin-bottom: 8px;
}

.weather-card .temperature {
  font-size: 24px;
  font-weight: 300;
  color: #333;
  margin-bottom: 12px;
}

.weather-card .reporter {
  font-size: 13px;
  color: #666;
  margin-bottom: 4px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.reporter-avatar {
  width: 24px;
  height: 24px;
  background: #007AFF;
  border-radius: 12px;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: 500;
}

.weather-card .timestamp {
  font-size: 12px;
  color: #999;
  display: flex;
  align-items: center;
  gap: 4px;
}

.weather-card .meta {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.interaction-buttons {
  display: flex;
  gap: 12px;
}

.interaction-button {
  padding: 6px 12px;
  border-radius: 15px;
  font-size: 12px;
  display: flex;
  align-items: center;
  gap: 4px;
  cursor: pointer;
  transition: background 0.2s ease;
}

.like-button {
  background: rgba(255, 45, 85, 0.1);
  color: #FF2D55;
}

.comment-button {
  background: rgba(0, 122, 255, 0.1);
  color: #007AFF;
}

.reports-container {
  display: none;
  height: 100%;
  padding: 65px 15px 80px;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow-y: auto;
}

.report-section {
  background: rgba(255, 255, 255, 0.85);
  border-radius: 20px;
  padding: 18px;
  margin-bottom: 15px;
  backdrop-filter: blur(10px);
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.chart-container {
  height: 280px;    /* Increased height for better visibility */
  margin: 20px 0;
  background: rgba(255, 255, 255, 0.7);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  backdrop-filter: blur(10px);
  padding: 15px;
}

.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-top: 15px;
}

.stat-card {
  background: rgba(255, 255, 255, 0.7);
  padding: 15px;
  border-radius: 12px;
}

.stat-label {
  font-size: 14px;
  color: #666;
}

.stat-value {
  font-size: 24px;
  font-weight: 600;
  color: #333;
  margin: 5px 0;
}

.stat-trend {
  font-size: 12px;
  color: #34C759;
}

.stat-trend.negative {
  color: #FF3B30;
}

.pattern-cards {
  display: grid;
  gap: 12px;
  margin-top: 15px;
}

.pattern-card {
  background: rgba(255, 255, 255, 0.7);
  padding: 15px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.pattern-icon {
  font-size: 24px;
}

.pattern-title {
  font-weight: 600;
  margin-bottom: 4px;
}

.pattern-desc {
  font-size: 14px;
  color: #666;
}

.book-container {
  background: rgba(255, 255, 255, 0.7);
  border-radius: 12px;
  padding: 15px;
  display: flex;
  gap: 15px;
  margin-top: 15px;
}

.book-cover {
  flex: 0 0 100px;
}

.book-svg {
  width: 100px;
  height: 150px;
}

.book-title {
  font-size: 12px;
  font-weight: bold;
}

.book-details {
  flex: 1;
}

.book-details h4 {
  margin: 0 0 10px 0;
  color: #333;
}

.book-details p {
  font-size: 14px;
  color: #666;
  margin: 0 0 15px 0;
}

.chapter-preview {
  background: rgba(0, 122, 255, 0.1);
  padding: 10px;
  border-radius: 8px;
}

.chapter-preview h5 {
  margin: 0 0 5px 0;
  color: #007AFF;
  font-size: 14px;
}

.chapter-preview p {
  margin: 0;
  font-size: 13px;
}

.export-button {
  background: #007AFF;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  width: 100%;
  cursor: pointer;
  margin: 10px 0;
}

.export-options {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 10px;
}

.export-options label {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}

.export-options input[type="checkbox"] {
  width: 16px;
  height: 16px;
}

.toast-container {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 2000;
  width: 90%;
  max-width: 350px;
}

.toast {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 15px;
  padding: 15px;
  margin-bottom: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  opacity: 0;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  gap: 8px;
  backdrop-filter: blur(10px);
}

.toast.show {
  opacity: 1;
}

.toast-sentence {
  color: #333;
  font-size: 14px;
  line-height: 1.4;
}

.toast-roast {
  color: #007AFF;
  font-size: 13px;
  line-height: 1.4;
  font-style: italic;
}

.calendar-section {
  background: rgba(255, 255, 255, 0.85);
  border-radius: 20px;
  padding: 18px;
  margin-bottom: 15px;
  backdrop-filter: blur(10px);
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  margin-top: 15px;
}

.calendar-header {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  margin-bottom: 8px;
}

.calendar-header-cell {
  text-align: center;
  font-size: 12px;
  color: #666;
}

.calendar-cell {
  aspect-ratio: 1;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: #333;
  background: rgba(255, 255, 255, 0.5);
  position: relative;
  cursor: pointer;
  transition: transform 0.2s;
}

.calendar-cell:hover {
  transform: scale(1.1);
}

.calendar-cell.has-data {
  background: rgba(0, 122, 255, 0.2);
}

.calendar-cell.high-mood {
  background: rgba(52, 199, 89, 0.3);
}

.calendar-cell.low-mood {
  background: rgba(255, 59, 48, 0.2);
}

.calendar-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.calendar-nav {
  display: flex;
  gap: 10px;
  align-items: center;
}

.calendar-nav-button {
  background: none;
  border: none;
  padding: 8px;
  cursor: pointer;
  color: #007AFF;
}

.calendar-title {
  font-size: 16px;
  font-weight: 600;
}

.calendar-legend {
  display: flex;
  gap: 15px;
  margin-top: 15px;
  justify-content: center;
  font-size: 12px;
  color: #666;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 5px;
}

.legend-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.collectibles-container {
  display: none;
  height: 100%;
  padding: 65px 15px 80px;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow-y: auto;
}

.promo-section {
  margin-bottom: 20px;
}

.promo-card {
  background: linear-gradient(135deg, #007AFF, #5856D6);
  border-radius: 20px;
  padding: 20px;
  color: white;
}

.promo-features {
  margin: 15px 0;
}

.feature-item {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 8px 0;
}

.subscribe-button {
  background: white;
  color: #007AFF;
  border: none;
  padding: 12px 24px;
  border-radius: 25px;
  font-weight: bold;
  width: 100%;
  margin-top: 15px;
  cursor: pointer;
}

.collection-section, .store-section, .ads-section {
  background: rgba(255, 255, 255, 0.85);
  border-radius: 20px;
  padding: 18px;
  margin-bottom: 15px;
  backdrop-filter: blur(10px);
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.weather-filter select {
  padding: 8px 12px;
  border-radius: 12px;
  border: 1px solid rgba(0, 122, 255, 0.2);
  background: white;
  font-size: 14px;
}

.theme-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 15px;
  margin-top: 15px;
}

.theme-card {
  background: white;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.theme-preview {
  height: 100px;
  background-size: cover;
  background-position: center;
}

.theme-info {
  padding: 10px;
}

.theme-name {
  font-weight: 500;
  margin-bottom: 4px;
}

.theme-weather {
  font-size: 12px;
  color: #666;
}

.pack-categories {
  display: flex;
  gap: 10px;
  overflow-x: auto;
  padding-bottom: 10px;
  scrollbar-width: none;
}

.pack-category {
  padding: 8px 16px;
  background: rgba(0, 122, 255, 0.1);
  border-radius: 15px;
  white-space: nowrap;
  cursor: pointer;
  font-size: 14px;
}

.pack-category.active {
  background: #007AFF;
  color: white;
}

.ads-card {
  background: linear-gradient(135deg, #FF9500, #FF2D55);
  border-radius: 20px;
  padding: 20px;
  color: white;
  text-align: center;
}

.reward-preview {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 15px;
  padding: 20px;
  margin: 15px 0;
}

.mystery-box {
  animation: pulse 2s infinite;
}

.mystery-text {
  margin-top: 10px;
  font-weight: 500;
}

.watch-ads-button {
  background: white;
  color: #FF2D55;
  border: none;
  padding: 12px 24px;
  border-radius: 25px;
  font-weight: bold;
  width: 100%;
  cursor: pointer;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

/* Add these styles for the share button and popup */
.share-button {
  position: absolute; 
  bottom: 80px;
  left: 20px;
  width: 50px;
  height: 50px;
  background: #007AFF;
  border-radius: 25px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 24px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  cursor: pointer;
  z-index: 1000;
}

.share-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1001;
}

.share-card {
  width: 320px;
  background: white;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.share-preview {
  width: 100%;
  height: 320px;
  background-size: cover;
  background-position: center;
  position: relative;
}

.share-preview-content {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 20px;
  background: linear-gradient(transparent, rgba(0,0,0,0.7));
  color: white;
}

.share-preview-temp {
  font-size: 48px;
  font-weight: 200;
  margin-bottom: 10px;
}

.share-preview-desc {
  font-size: 16px;
  margin-bottom: 10px;
}

.share-preview-roast {
  font-style: italic;
  font-size: 14px;
  opacity: 0.9;
}

.share-actions {
  padding: 20px;
}

.share-buttons {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  margin-top: 15px;
}

.share-btn {
  padding: 12px;
  border-radius: 12px;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  cursor: pointer;
  font-size: 14px;
  transition: background 0.2s;
}

.share-btn.sms {
  background: #34C759;
  color: white;
}

.share-btn.social {
  background: #007AFF;
  color: white;
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/heatmap.js@2.0.5/build/heatmap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/heatmap.js@2.0.5/plugins/leaflet-heatmap/leaflet-heatmap.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.24.0/dist/duckdb-eh.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.24.0/dist/duckdb-browser.js"></script>
</head><body>

<div class="mobile-container today" id="weatherContainer">
  <div class="notch"></div>
  <div class="status-bar">
    <span class="time">9:41</span>
    <div class="status-icons">
      <span>5G</span>
      <span>100%</span>
    </div>
  </div>
  
  <div class="menu-button" id="menuButton">
    <svg viewBox="0 0 24 24" width="24" height="24">
      <path fill="currentColor" d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>
    </svg>
  </div>

  <div class="menu-modal" id="menuModal">
    <div class="menu-item" data-page="weather">Weather</div>
    <div class="menu-item" data-page="radar">Weather Radar</div>
    <div class="menu-item" data-page="friends">Friends</div>
    <div class="menu-item" data-page="report">Reports</div>
    <div class="menu-item" data-page="collectibles">Collectibles</div>
    <div class="menu-item" data-page="settings">Settings</div>
  </div>

  <div class="content">
    <div class="weather-info">
      <div class="location" data-i18n="location">Heisenberg</div>
      <div class="weather-icon">
        <svg class="sun" viewBox="0 0 100 100" width="120" height="120">
          <circle cx="50" cy="50" r="20" fill="#FFD700"/>
          <line x1="50" y1="20" x2="50" y2="10" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/>
          <line x1="50" y1="80" x2="50" y2="90" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/>
          <line x1="20" y1="50" x2="10" y2="50" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/>
          <line x1="80" y1="50" x2="90" y2="50" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/>
          <line x1="30" y1="30" x2="22" y2="22" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/>
          <line x1="70" y1="30" x2="78" y2="22" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/>
          <line x1="30" y1="70" x2="22" y2="78" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/>
          <line x1="70" y1="70" x2="78" y2="78" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="temperature">72</div>
      <div style="font-size: 18px; margin-bottom: 20px; color: #333; text-shadow: 1px 1px 2px rgba(255,255,255,0.8);" data-i18n="sunny">Sunny</div>
      
      <div class="hourly-forecast">
        <h3 style="text-align: left; margin-bottom: 10px; color: #333;">24-Hour Log</h3>
        <div class="hourly-scroll">
          <div class="hourly-item">
            <div class="hourly-time">Now</div>
            <div class="hourly-temp">72</div>
          </div>
          <div class="hourly-item">
            <div class="hourly-time">11 AM</div>
            <div class="hourly-temp">74</div>
          </div>
          <div class="hourly-item">
            <div class="hourly-time">12 PM</div>
            <div class="hourly-temp">75</div>
          </div>
          <div class="hourly-item">
            <div class="hourly-time">1 PM</div>
            <div class="hourly-temp">76</div>
          </div>
          <div class="hourly-item">
            <div class="hourly-time">2 PM</div>
            <div class="hourly-temp">76</div>
          </div>
          <div class="hourly-item">
            <div class="hourly-time">3 PM</div>
            <div class="hourly-temp">75</div>
          </div>
          <div class="hourly-item">
            <div class="hourly-time">4 PM</div>
            <div class="hourly-temp">74</div>
          </div>
          <div class="hourly-item">
            <div class="hourly-time">5 PM</div>
            <div class="hourly-temp">72</div>
          </div>
          <div class="hourly-item">
            <div class="hourly-time">6 PM</div>
            <div class="hourly-temp">70</div>
          </div>
          <div class="hourly-item">
            <div class="hourly-time">7 PM</div>
            <div class="hourly-temp">68</div>
          </div>
          <div class="hourly-item">
            <div class="hourly-time">8 PM</div>
            <div class="hourly-temp">67</div>
          </div>
          <div class="hourly-item">
            <div class="hourly-time">9 PM</div>
            <div class="hourly-temp">66</div>
          </div>
        </div>
      </div>

      <div class="weather-details">
        <div class="detail-card">
          <div class="detail-label">Stress</div>
          <div class="detail-value">25%</div>
        </div>
        <div class="detail-card">
          <div class="detail-label">Eating</div>
          <div class="detail-value">30%</div>
        </div>
        <div class="detail-card">
          <div class="detail-label">Activity</div>
          <div class="detail-value">20%</div>
        </div>
        <div class="detail-card">
          <div class="detail-label">Sleep</div>
          <div class="detail-value">25%</div>
        </div>
      </div>
    </div>
    
    <div class="forecast">
      <div class="forecast-item" onclick="setDay('monday')" style="cursor: pointer;">
        <div class="forecast-day">MON</div>
        <div class="forecast-temp">74</div>
      </div>
      <div class="forecast-item" onclick="setDay('today')" style="cursor: pointer;">
        <div class="forecast-day">TUE</div>
        <div class="forecast-temp">76</div>
      </div>
      <div class="forecast-item" onclick="setDay('wedsday')" style="cursor: pointer;">
        <div class="forecast-day">WED</div>
        <div class="forecast-temp">71</div>
      </div>
      <div class="forecast-item" onclick="setDay('thursday')" style="cursor: pointer;">
        <div class="forecast-day">THU</div>
        <div class="forecast-temp">73</div>
      </div>
      <div class="forecast-item" onclick="setDay('friday')" style="cursor: pointer;">
        <div class="forecast-day">FRI</div>
        <div class="forecast-temp">75</div>
      </div>
    </div>
  </div>
  
  <div class="radar-container" id="radarPage">
    <div class="radar-section">
      <h3>Live Weather Radar</h3>
      <div class="radar-animation">
        <svg width="100%" height="100%" viewBox="0 0 100 100" class="radar-overlay">
          <circle cx="50" cy="50" r="45" fill="none" stroke="rgba(255,255,255,0.1)" />
          <circle cx="50" cy="50" r="30" fill="none" stroke="rgba(255,255,255,0.1)" />
          <circle cx="50" cy="50" r="15" fill="none" stroke="rgba(255,255,255,0.1)" />
          
          <line x1="0" y1="50" x2="100" y2="50" stroke="rgba(255,255,255,0.1)" />
          <line x1="50" y1="0" x2="50" y2="100" stroke="rgba(255,255,255,0.1)" />
          
          <g class="radar-sweep">
            <path d="M50,50 L50,5 A45,45 0 0,1 95,50 Z" fill="rgba(0,122,255,0.2)" />
          </g>
          
          <g class="weather-phenomena">
            <circle cx="25" cy="75" r="4.7" fill="#e74c3c" opacity="0.7" />
            <circle cx="70" cy="54" r="4.5" fill="#e74c3c" opacity="0.65" />
            <circle cx="33" cy="45" r="4.4" fill="#3498db" opacity="0.63" />
            <circle cx="28" cy="53" r="2.9" fill="#3498db" opacity="0.66" />
            <circle cx="46" cy="56" r="2.8" fill="#3498db" opacity="0.82" />
            <circle cx="59" cy="38" r="5.6" fill="#3498db" opacity="0.75" />
            <circle cx="50" cy="50" r="10" fill="none" stroke="rgba(0,122,255,0.3)" class="radar-pulse" />
            <circle cx="50" cy="50" r="20" fill="none" stroke="rgba(0,122,255,0.2)" class="radar-pulse" style="animation-delay: 0.5s" />
            <circle cx="50" cy="50" r="30" fill="none" stroke="rgba(0,122,255,0.1)" class="radar-pulse" style="animation-delay: 1s" />
          </g>
        </svg>
      </div>
      
      <div class="radar-scanning-details">
        <div class="radar-detail-card">
          <div class="radar-detail-label">Precipitation</div>
          <div class="radar-detail-value">Light Rain</div>
        </div>
        <div class="radar-detail-card">
          <div class="radar-detail-label">Cloud Cover</div>
          <div class="radar-detail-value">65%</div>
        </div>
        <div class="radar-detail-card">
          <div class="radar-detail-label">Radar Range</div>
          <div class="radar-detail-value">50 miles</div>
        </div>
        <div class="radar-detail-card">
          <div class="radar-detail-label">Last Update</div>
          <div class="radar-detail-value">2 min ago</div>
        </div>
      </div>

      <div class="weather-alert" style="background: rgba(103, 58, 183, 0.08); border-left: 4px solid #673AB7;">
        <div class="alert-title" style="color: #673AB7;">Friendly Advice</div>
        <div class="alert-message">
          If you are down, may be call a cheer up friend nearby 
          <div style="margin-top: 8px; font-size: 12px; color: #666;">
            <svg style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;" viewBox="0 0 24 24">
              <path fill="currentColor" d="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"/>
            </svg>
            Remember: A friend's voice can brighten your day
          </div>
        </div>
      </div>
    </div>
    
    <div class="leaderboard-section">
      <h3>Weather Reporters Leaderboard</h3>
      
      <div class="filter-controls">
        <select class="filter-select" id="yearFilter">
          <option value="2024">2024</option>
          <option value="2023">2023</option>
        </select>
        <select class="filter-select" id="monthFilter">
          <option value="all">All Months</option>
          <option value="1">January</option>
          <option value="2">February</option>
          <option value="3">March</option>
          <option value="4">April</option>
          <option value="5">May</option>
          <option value="6">June</option>
          <option value="7">July</option>
          <option value="8">August</option>
          <option value="9">September</option>
          <option value="10">October</option>
          <option value="11">November</option>
          <option value="12">December</option>
        </select>
      </div>

      <div class="leaderboard-tabs">
        <div class="leaderboard-tab active" data-type="reports">Most Reports</div>
        <div class="leaderboard-tab" data-type="streak">Longest Streaks</div>
        <div class="leaderboard-tab" data-type="accuracy">Most Accurate</div>
        <div class="leaderboard-tab" data-type="impact">Community Impact</div>
      </div>

      <div id="leaderboardContent">
        <!-- This will be populated by JavaScript -->
      </div>
    </div>
  </div>

  <div class="friends-container" id="friendsPage">
    <div class="map-section">
      <h3>Weather Reporter Locations</h3>
      <div class="reporter-map" id="reporterMap">
        <!-- Map will be rendered here -->
      </div>
      <div class="map-stats">
        <div class="map-stat-card">
          <div class="stat-label">Most Active City</div>
          <div class="stat-value">San Francisco</div>
          <div class="stat-trend">+24% this week</div>
        </div>
        <div class="map-stat-card">
          <div class="stat-label">Active Reporters</div>
          <div class="stat-value">324</div>
          <div class="stat-trend">+12 new today</div>
        </div>
      </div>
    </div>
    
    <div class="feed-section">
      <h3>
        Recent Weather Reports
        <span class="feed-filter">Filter</span>
      </h3>
      
      <div class="weather-card">
        <div class="location">Sam Altman</div>
        <div class="temperature">68¬∞</div>
        <div class="meta">
          <div class="reporter">
            <div class="reporter-avatar">JD</div>
            <span>Donald Trump</span>
          </div>
          <div class="interaction-buttons">
            <div class="interaction-button like-button">
              <svg width="12" height="12" viewBox="0 0 24 24">
                <path fill="currentColor" d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z"/>
              </svg>
              24
            </div>
            <div class="interaction-button comment-button">
              <svg width="12" height="12" viewBox="0 0 24 24">
                <path fill="currentColor" d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2M6,9H18V11H6M14,14H6V12H14M18,8H6V6H18"/>
              </svg>
              5
            </div>
          </div>
        </div>
        <div class="timestamp">
          <svg width="12" height="12" viewBox="0 0 24 24">
            <path fill="currentColor" d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"/>
          </svg>
          2 hours ago
        </div>
      </div>

      <div class="weather-card">
        <div class="location">Los Angeles</div>
        <div class="temperature">75¬∞</div>
        <div class="meta">
          <div class="reporter">
            <div class="reporter-avatar">JS</div>
            <span>Jane Smith</span>
          </div>
          <div class="interaction-buttons">
            <div class="interaction-button like-button">
              <svg width="12" height="12" viewBox="0 0 24 24">
                <path fill="currentColor" d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z"/>
              </svg>
              18
            </div>
            <div class="interaction-button comment-button">
              <svg width="12" height="12" viewBox="0 0 24 24">
                <path fill="currentColor" d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2M6,9H18V11H6M14,14H6V12H14M18,8H6V6H18"/>
              </svg>
              3
            </div>
          </div>
        </div>
        <div class="timestamp">
          <svg width="12" height="12" viewBox="0 0 24 24">
            <path fill="currentColor" d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"/>
          </svg>
          3 hours ago
        </div>
      </div>
    </div>
  </div>
  
  <div class="reports-container" id="reportsPage">
    <div class="report-section">
      <h3>Statistics</h3>
      <div id="statisticsChart" class="chart-container"></div>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Reports</div>
          <div class="stat-value">1,248</div>
          <div class="stat-trend positive">+12% this month</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Average Mood</div>
          <div class="stat-value">7.5/10</div>
          <div class="stat-trend positive">+0.8 vs last month</div>
        </div>
      </div>
    </div>

    <div class="report-section">
      <h3>Patterns</h3>
      <div class="pattern-cards">
        <div class="pattern-card">
          <div class="pattern-icon">üåßÔ∏è</div>
          <div class="pattern-title">Rainy Days Impact</div>
          <div class="pattern-desc">Your mood tends to drop by 20% during consecutive rainy days</div>
        </div>
        <div class="pattern-card">
          <div class="pattern-icon">‚òÄÔ∏è</div>
          <div class="pattern-title">Sunshine Effect</div>
          <div class="pattern-desc">Sunny weekends correlate with 30% higher activity levels</div>
        </div>
      </div>
    </div>

    <div class="report-section">
      <h3>Recommended</h3>
      <div class="book-container">
        <div class="book-cover">
          <svg viewBox="0 0 100 150" class="book-svg">
            <rect x="10" y="10" width="80" height="130" rx="2" fill="#4A90E2"/>
            <text x="50" y="50" text-anchor="middle" fill="white" class="book-title">100 Ways</text>
            <text x="50" y="70" text-anchor="middle" fill="white" class="book-title">to Cheer Up</text>
          </svg>
        </div>
        <div class="book-details">
          <h4>100 Methods to Cheer You Up</h4>
          <p>A practical guide to lifting your spirits through proven psychological techniques and fun activities.</p>
          <div class="chapter-preview">
            <h5>Today's Recommended Chapter</h5>
            <p>Chapter 7: The Power of Weather Walking</p>
          </div>
        </div>
      </div>
    </div>

    <div class="calendar-section">
      <h3>Calendar</h3>
      <div class="calendar-controls">
        <div class="calendar-nav">
          <button class="calendar-nav-button prev-month">
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"/>
            </svg>
          </button>
          <div class="calendar-title"></div>
          <button class="calendar-nav-button next-month">
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"/>
            </svg>
          </button>
        </div>
      </div>
      
      <div class="calendar-header">
        <div class="calendar-header-cell">Sun</div>
        <div class="calendar-header-cell">Mon</div>
        <div class="calendar-header-cell">Tue</div>
        <div class="calendar-header-cell">Wed</div>
        <div class="calendar-header-cell">Thu</div>
        <div class="calendar-header-cell">Fri</div>
        <div class="calendar-header-cell">Sat</div>
      </div>
      
      <div class="calendar-grid"></div>
      
      <div class="calendar-legend">
        <div class="legend-item">
          <div class="legend-dot" style="background: rgba(52, 199, 89, 0.3)"></div>
          <span>Sunny</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background: rgba(0, 122, 255, 0.2)"></div>
          <span>Rainy</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background: rgba(255, 59, 48, 0.2)"></div>
          <span>Storm</span>
        </div>
      </div>
    </div>
  </div>

  <div class="collectibles-container" id="collectiblesPage">
    <!-- Subscription Promotion -->
    <div class="promo-section">
      <div class="promo-card">
        <div class="promo-content">
          <h3>Premium Weather Collection</h3>
          <p>Subscribe to unlock exclusive themes and weather animations!</p>
          <div class="promo-features">
            <div class="feature-item">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path fill="#34C759" d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"/>
              </svg>
              <span>Unlimited Theme Access</span>
            </div>
            <div class="feature-item">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path fill="#34C759" d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"/>
              </svg>
              <span>Early Access to New Packs</span>
            </div>
            <div class="feature-item">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path fill="#34C759" d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"/>
              </svg>
              <span>Ad-Free Experience</span>
            </div>
          </div>
          <button class="subscribe-button">Subscribe Now</button>
        </div>
      </div>
    </div>

    <!-- My Collection -->
    <div class="collection-section">
      <div class="section-header">
        <h3>My Collection</h3>
        <div class="weather-filter">
          <select id="weatherFilter">
            <option value="all">All Weather</option>
            <option value="sunny">Sunny</option>
            <option value="rainy">Rainy</option>
            <option value="cloudy">Cloudy</option>
            <option value="snowy">Snowy</option>
          </select>
        </div>
      </div>
      <div class="theme-grid" id="myCollection">
        <!-- Theme cards will be populated here -->
      </div>
    </div>

    <!-- Theme Store -->
    <div class="store-section">
      <h3>Theme Store</h3>
      <div class="pack-categories">
        <div class="pack-category active">Cartoon Pack</div>
        <div class="pack-category">City Pack</div>
        <div class="pack-category">Nature Pack</div>
      </div>
      <div class="theme-grid" id="themeStore">
        <!-- Store items will be populated here -->
      </div>
    </div>

    <!-- Watch Ads Section -->
    <div class="ads-section">
      <div class="ads-card">
        <div class="ads-content">
          <h3>Get Free Themes</h3>
          <p>Watch a short video to unlock a random theme!</p>
          <div class="reward-preview">
            <div class="mystery-box">
              <svg viewBox="0 0 24 24" width="48" height="48">
                <path fill="#FFD700" d="M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"/>
              </svg>
            </div>
            <div class="mystery-text">Mystery Theme</div>
          </div>
          <button class="watch-ads-button">Watch Ad</button>
        </div>
      </div>
    </div>
  </div>

  <div class="share-button" id="shareButton">
    <svg viewBox="0 0 24 24" width="24" height="24">
      <path fill="currentColor" d="M18,16.08C17.24,16.08 16.56,16.38 16.04,16.85L8.91,12.7C8.96,12.47 9,12.24 9,12C9,11.76 8.96,11.53 8.91,11.3L15.96,7.19C16.5,7.69 17.21,8 18,8A3,3 0 0,0 21,5A3,3 0 0,0 18,2A3,3 0 0,0 15,5C15,5.24 15.04,5.47 15.09,5.7L8.04,9.81C7.5,9.31 6.79,9 6,9A3,3 0 0,0 3,12A3,3 0 0,0 6,15C6.79,15 7.5,14.69 8.04,14.19L15.16,18.34C15.11,18.55 15.08,18.77 15.08,19C15.08,20.61 16.39,21.91 18,21.91C19.61,21.91 20.92,20.61 20.92,19A2.92,2.92 0 0,0 18,16.08Z" />
    </svg>
  </div>

  <div class="share-modal-overlay" id="shareModalOverlay">
    <div class="share-card">
      <div class="share-preview">
        <div class="share-preview-content">
          <div class="share-preview-temp">72¬∞</div>
          <div class="share-preview-desc">Sunny in Heisenberg</div>
          <div class="share-preview-roast">Looks like the weather is better than your mood today! üòâ</div>
        </div>
      </div>
      <div class="share-actions">
        <h3>Share this moment</h3>
        <div class="share-buttons">
          <button class="share-btn sms">
            <svg viewBox="0 0 24 24" width="18" height="18">
              <path fill="currentColor" d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2M6,9H18V11H6M14,14H6V12H14M18,8H6V6H18"/>
            </svg>
            Share via SMS
          </button>
          <button class="share-btn social">
            <svg viewBox="0 0 24 24" width="18" height="18">
              <path fill="currentColor" d="M18,16.08C17.24,16.08 16.56,16.38 16.04,16.85L8.91,12.7C8.96,12.47 9,12.24 9,12C9,11.76 8.96,11.53 8.91,11.3L15.96,7.19C16.5,7.69 17.21,8 18,8A3,3 0 0,0 21,5A3,3 0 0,0 18,2A3,3 0 0,0 15,5C15,5.24 15.04,5.47 15.09,5.7L8.04,9.81C7.5,9.31 6.79,9 6,9A3,3 0 0,0 3,12A3,3 0 0,0 6,15C6.79,15 7.5,14.69 8.04,14.19L15.16,18.34C15.11,18.55 15.08,18.77 15.08,19C15.08,20.61 16.39,21.91 18,21.91C19.61,21.91 20.92,20.61 20.92,19A2.92,2.92 0 0,0 18,16.08Z"/>
            </svg>
            Share More
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="add-button" id="addButton">+</div>
  <div class="home-indicator"></div>
</div>

<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <div class="modal-header">
      <h3>Select Tags</h3>
      <button class="close-button" id="closeModal">√ó</button>
    </div>
    <div class="breadcrumb" id="breadcrumb"></div>
    <div class="tag-group" id="tagGroup"></div>
    
    <div class="voice-container">
      <div class="input-method-toggle">
        <button class="input-method-button active" data-method="type">Type</button>
        <button class="input-method-button" data-method="record">Record</button>
      </div>
      
      <button class="record-button" id="recordButton" style="display: none;">
        <svg class="mic-icon" viewBox="0 0 24 24">
          <path fill="currentColor" d="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z"/>
        </svg>
        Start Recording
      </button>
      
      <textarea 
        class="note-input" 
        id="noteInput"
        placeholder="Type your note here..."
      ></textarea>
    </div>

    <button class="save-button" id="saveButton" disabled>Save</button>
  </div>
</div>

<div class="settings-modal-overlay" id="settingsModalOverlay">
  <div class="modal">
    <div class="modal-header">
      <h3>Settings</h3>
      <button class="close-button" id="closeSettingsModal">√ó</button>
    </div>
    <div class="settings-content">
      <div class="setting-item">
        <label for="languageSelect">Language</label>
        <select id="languageSelect" class="language-select">
          <option value="en">English</option>
          <option value="es">Espa√±ol</option>
          <option value="zh">‰∏≠Êñá</option>
          <option value="ja">Êó•Êú¨Ë™û</option>
        </select>
      </div>
      <div class="setting-item">
        <button class="export-button" id="exportDataButton" data-i18n="export_data">Export Data</button>
      </div>
      <div class="setting-item">
        <div class="export-options">
          <label><input type="checkbox" value="weather_reports" checked> Weather Reports</label>
          <label><input type="checkbox" value="user_stats" checked> User Statistics</label>
          <label><input type="checkbox" value="interactions" checked> Interactions</label>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
let db;
let dbInitialized = false;

// DuckDB initialization
async function initDB() {
  try {
    // Initialize DuckDB
    const bundle = await duckdb.selectBundle({
      mvp: {
        mainModule: 'https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.24.0/dist/duckdb-mvp.wasm',
        mainWorker: 'https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.24.0/dist/duckdb-browser-mvp.worker.js',
      },
      eh: {
        mainModule: 'https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.24.0/dist/duckdb-eh.wasm',
        mainWorker: 'https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.24.0/dist/duckdb-browser-eh.worker.js'
      }
    });
    
    const worker = new Worker(bundle.mainWorker);
    db = new duckdb.AsyncDuckDB(worker);
    await db.instantiate(bundle.mainModule);
    
    const conn = await db.connect();
    
    // Update schema with additional tables
    await conn.query(`
      CREATE TABLE IF NOT EXISTS translations (
        key VARCHAR,
        lang VARCHAR,
        value VARCHAR,
        category VARCHAR,
        PRIMARY KEY (key, lang)
      );

      CREATE TABLE IF NOT EXISTS weather_reports (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        temperature FLOAT,
        location VARCHAR,
        description VARCHAR,
        timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        user_id INTEGER,
        tags JSON,
        note VARCHAR
      );

      CREATE TABLE IF NOT EXISTS user_interactions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        report_id INTEGER,
        interaction_type VARCHAR,
        timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
      );

      CREATE TABLE IF NOT EXISTS user_stats (
        user_id INTEGER PRIMARY KEY,
        total_reports INTEGER DEFAULT 0,
        streak_days INTEGER DEFAULT 0,
        last_report_date DATE,
        favorite_locations JSON
      );
    `);

    // Insert initial translations
    await conn.query(`
      INSERT OR IGNORE INTO translations VALUES
      ('location', 'en', 'Heisenberg', 'weather'),
      ('location', 'es', 'Heisenberg', 'weather'),
      ('location', 'zh', 'Heisenberg', 'weather'),
      ('location', 'ja', 'Heisenberg', 'weather'),
      ('sunny', 'en', 'Sunny', 'weather'),
      ('sunny', 'es', 'Soleado', 'weather'),
      ('sunny', 'zh', 'Êô¥Â§©', 'weather'),
      ('sunny', 'ja', 'Êô¥„Çå', 'weather'),
      ('export_data', 'en', 'Export Data', 'settings'),
      ('export_data', 'es', 'Exportar Datos', 'settings'),
      ('export_data', 'zh', 'ÂØºÂá∫Êï∞ÊçÆ', 'settings'),
      ('export_data', 'ja', '„Éá„Éº„Çø„ÅÆ„Ç®„ÇØ„Çπ„Éù„Éº„Éà', 'settings')
    `);

    await conn.close();
    dbInitialized = true;
    console.log('Database initialized successfully');
  } catch (error) {
    console.error('Error initializing database:', error);
    dbInitialized = false;
  }
}

// New emotion-based tag hierarchy
const tagHierarchy = {
  "Happy": {
    "Playful": ["Aroused", "Cheeky"],
    "Content": ["Free", "Joyful"],
    "Interested": ["Curious", "Inquisitive"],
    "Proud": ["Successful", "Confident"],
    "Accepted": ["Respected", "Valued"],
    "Powerful": ["Courageous", "Creative"],
    "Peaceful": ["Loving", "Thankful"],
    "Trusting": ["Sensitive", "Intimate"],
    "Optimistic": ["Hopeful", "Inspired"]
  },
  "Surprised": {
    "Startled": ["Shocked", "Dismayed"],
    "Confused": ["Disillusioned", "Perplexed"],
    "Amazed": ["Astonished", "Awe"],
    "Excited": ["Eager", "Energetic"]
  },
  "Bad": {
    "Bored": ["Indifferent", "Apathetic"],
    "Busy": ["Pressured", "Rushed"],
    "Stressed": ["Overwhelmed", "Out of control"],
    "Tired": ["Sleepy", "Unfocused"]
  },
  "Fearful": {
    "Scared": ["Helpless", "Frightened"],
    "Anxious": ["Overwhelmed", "Worried"],
    "Insecure": ["Inadequate", "Inferior"],
    "Weak": ["Worthless", "Insignificant"],
    "Rejected": ["Excluded", "Persecuted"],
    "Threatened": ["Nervous", "Exposed"]
  },
  "Angry": {
    "Let down": ["Betrayed", "Resentful"],
    "Humiliated": ["Disrespected", "Ridiculed"],
    "Bitter": ["Indignant", "Violated"],
    "Mad": ["Furious", "Jealous"],
    "Aggressive": ["Provoked", "Hostile"],
    "Frustrated": ["Infuriated", "Annoyed"],
    "Distant": ["Withdrawn", "Numb"],
    "Critical": ["Skeptical", "Dismissive"]
  },
  "Disgusted": {
    "Disapproving": ["Judgmental", "Embarrassed"],
    "Disappointed": ["Appalled", "Revolted"],
    "Awful": ["Nauseated", "Detestable"],
    "Repelled": ["Horrified", "Hesitant"]
  },
  "Sad": {
    "Hurt": ["Embarrassed", "Disappointed"],
    "Depressed": ["Inferior", "Empty"],
    "Guilty": ["Remorseful", "Ashamed"],
    "Despair": ["Powerless", "Grief"],
    "Vulnerable": ["Fragile", "Victimized"],
    "Lonely": ["Isolated", "Abandoned"]
  }
};

// Update the selectTag function to handle the new structure
function selectTag(tag) {
  selectedTags[currentLevel] = tag;
  selectedTags = selectedTags.slice(0, currentLevel + 1);
  currentLevel++;
  
  updateBreadcrumb();
  
  let nextLevel;
  if (currentLevel === 1) {
    nextLevel = tagHierarchy[tag];
  } else if (currentLevel === 2) {
    nextLevel = tagHierarchy[selectedTags[0]][tag];
  } else {
    nextLevel = null;
  }
  
  if (nextLevel) {
    if (Array.isArray(nextLevel)) {
      renderTags(nextLevel);
    } else {
      renderTags(Object.keys(nextLevel));
    }
  }
  
  if (currentLevel >= 1) {
    saveButton.disabled = false;
  }
}

// Add click handlers for leaderboard tabs
document.querySelectorAll('.leaderboard-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    // Update active state
    document.querySelectorAll('.leaderboard-tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    
    // Update leaderboard content
    updateLeaderboard(tab.dataset.type);
  });
});

// Add this function to provide leaderboard data
function getLeaderboardData(type) {
  // Mock data for different leaderboard types
  const data = {
    reports: [
      { name: 'Sarah Johnson', value: '156', trend: '12' },
      { name: 'Mike Chen', value: '143', trend: '8' },
      { name: 'Alex Martinez', value: '128', trend: '15' },
      { name: 'Emily Wilson', value: '112', trend: '6' },
      { name: 'David Kim', value: '98', trend: '9' }
    ],
    streak: [
      { name: 'John Smith', value: '85', trend: '5' },
      { name: 'Lisa Brown', value: '72', trend: '3' },
      { name: 'Tom Anderson', value: '65', trend: '4' },
      { name: 'Maria Garcia', value: '58', trend: '2' },
      { name: 'James Lee', value: '45', trend: '3' }
    ],
    accuracy: [
      { name: 'Emma Davis', value: '98.5%', trend: '0.5' },
      { name: 'Chris Taylor', value: '97.2%', trend: '0.8' },
      { name: 'Sophie Martin', value: '96.8%', trend: '0.3' },
      { name: 'Ryan White', value: '95.5%', trend: '0.6' },
      { name: 'Nina Patel', value: '94.9%', trend: '0.4' }
    ],
    impact: [
      { name: 'Kate Williams', value: '234', trend: '18' },
      { name: 'Daniel Lopez', value: '198', trend: '15' },
      { name: 'Rachel Green', value: '176', trend: '12' },
      { name: 'Kevin Chang', value: '145', trend: '9' },
      { name: 'Anna Clark', value: '132', trend: '7' }
    ]
  };

  // Return data for the requested type, or reports as default
  return data[type] || data.reports;
}

// Update updateLeaderboard function to handle percentage formatting
function updateLeaderboard(type) {
  const data = getLeaderboardData(type);
  const leaderboardContent = document.getElementById('leaderboardContent');
  
  let html = '';
  data.forEach((item, index) => {
    // Format the trend display based on type
    const trendDisplay = type === 'accuracy' ? 
      `+${item.trend}%` : 
      `+${item.trend} ${type === 'streak' ? 'days' : 
                       type === 'impact' ? 'people' : 
                       'reports'}`;
    
    html += `
      <div class="leaderboard-item">
        <div style="display: flex; align-items: center; gap: 12px;">
          <div style="font-size: 16px; color: ${index < 3 ? '#007AFF' : '#666'}; font-weight: ${index < 3 ? '600' : 'normal'}">
            #${index + 1}
          </div>
          <div>
            <div style="font-weight: 500;">${item.name}</div>
            <div style="font-size: 12px; color: #666;">
              ${type === 'reports' ? 'Reports this month' :
                type === 'streak' ? 'Day streak' :
                type === 'accuracy' ? 'Accuracy rate' :
                'People helped'}
            </div>
          </div>
        </div>
        <div style="text-align: right;">
          <div style="font-weight: 500;">${item.value}</div>
          <div style="font-size: 12px; color: #34C759;">
            ${trendDisplay}
          </div>
        </div>
      </div>
    `;
  });
  
  leaderboardContent.innerHTML = html;
}

// Initialize leaderboard on radar page load
function initializeLeaderboard() {
  // Update filters with current date
  const currentDate = new Date();
  document.getElementById('yearFilter').value = currentDate.getFullYear();
  document.getElementById('monthFilter').value = currentDate.getMonth() + 1;
  
  // Show initial data (reports tab)
  updateLeaderboard('reports');
}

// Add filter change handlers
document.getElementById('yearFilter').addEventListener('change', () => {
  const activeTab = document.querySelector('.leaderboard-tab.active');
  updateLeaderboard(activeTab.dataset.type);
});

document.getElementById('monthFilter').addEventListener('change', () => {
  const activeTab = document.querySelector('.leaderboard-tab.active');
  updateLeaderboard(activeTab.dataset.type);
});

// Update navigation function to initialize leaderboard
const oldNavigateToPage = navigateToPage;
navigateToPage = function(page) {
  oldNavigateToPage(page);
  if (page === 'radar') {
    initializeLeaderboard();
  } else if (page === 'collectibles') {
    document.getElementById('collectiblesPage').style.display = 'block';
    initializeCollectibles();
  }
};

// Data export functions
async function exportData() {
  if (!dbInitialized || !db) {
    console.error('Database not initialized');
    return;
  }

  try {
    const conn = await db.connect();
    
    const selectedTables = Array.from(document.querySelectorAll('.export-options input:checked'))
      .map(checkbox => checkbox.value);
    
    const exportData = {};
    
    for (const table of selectedTables) {
      const result = await conn.query(`SELECT * FROM ${table}`);
      exportData[table] = result.toArray();
    }
    
    const dataStr = JSON.stringify(exportData, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    
    const downloadLink = document.createElement('a');
    downloadLink.href = url;
    downloadLink.download = `weather_data_export_${new Date().toISOString()}.json`;
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
    URL.revokeObjectURL(url);
    
    await conn.close();
  } catch (error) {
    console.error('Error exporting data:', error);
  }
}

// Add event listener for export button
document.getElementById('exportDataButton').addEventListener('click', exportData);

// Add data ingestion functions
async function saveWeatherReport(reportData) {
  if (!dbInitialized || !db) {
    console.error('Database not initialized');
    return;
  }

  try {
    const conn = await db.connect();
    
    await conn.query(`
      INSERT INTO weather_reports (temperature, location, description, user_id, tags, note)
      VALUES (?, ?, ?, ?, ?, ?)
    `, [
      reportData.temperature,
      reportData.location,
      reportData.description,
      reportData.userId,
      JSON.stringify(reportData.tags),
      reportData.note
    ]);
    
    // Update user stats
    await conn.query(`
      INSERT OR REPLACE INTO user_stats (user_id, total_reports, streak_days, last_report_date)
      VALUES (
        ?,
        COALESCE((SELECT total_reports + 1 FROM user_stats WHERE user_id = ?), 1),
        CASE 
          WHEN DATE(last_report_date) = DATE('now', '-1 day') THEN streak_days + 1
          WHEN DATE(last_report_date) = DATE('now') THEN streak_days
          ELSE 1
        END,
        CURRENT_TIMESTAMP
      )
    `, [reportData.userId, reportData.userId]);
    
    await conn.close();
  } catch (error) {
    console.error('Error saving weather report:', error);
  }
}

// Update the setupVoiceRecording function
async function setupVoiceRecording() {
  const inputMethodButtons = document.querySelectorAll('.input-method-button');
  const recordButton = document.getElementById('recordButton');
  const noteInput = document.getElementById('noteInput');

  inputMethodButtons.forEach(button => {
    button.addEventListener('click', () => {
      // Update active state
      inputMethodButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
      
      // Show/hide relevant input method
      if (button.dataset.method === 'record') {
        recordButton.style.display = 'flex';
        noteInput.style.display = 'none';
      } else {
        recordButton.style.display = 'none';
        noteInput.style.display = 'block';
      }
    });
  });

  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    
    mediaRecorder.ondataavailable = (event) => {
      audioChunks.push(event.data);
    };
    
    mediaRecorder.onstop = async () => {
      const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
      
      try {
        const response = await fetch('/api/ai_completion', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            prompt: 'Transcribe the audio to text',
            data: 'Sample transcription: Weather is sunny today'
          })
        });
        
        const data = await response.json();
        noteInput.value = data.transcription || 'Weather is sunny today';
        noteInput.style.display = 'block';
        recordButton.style.display = 'none';
        
        // Switch back to type mode after recording
        inputMethodButtons.forEach(btn => {
          btn.classList.remove('active');
          if (btn.dataset.method === 'type') btn.classList.add('active');
        });
        
        saveButton.disabled = false;
      } catch (error) {
        console.error('Transcription error:', error);
        noteInput.value = 'Error transcribing audio';
        saveButton.disabled = false;
      }
      
      audioChunks = [];
    };
    
    recordButton.addEventListener('click', toggleRecording);
  } catch (error) {
    console.error('Error accessing microphone:', error);
    recordButton.disabled = true;
    recordButton.textContent = 'Microphone access denied';
  }
}

// Update the saveTags function to show toast after saving
const weatherInspiredRoasts = {
  "weather_inspired_roasts": [
    {
      "sentence": "ÊàëÁöÑÂøÉÊÉÖÂÉèÊòØÈò¥Â§©ÔºåÊ≤âÈó∑ÂæóËÆ©‰∫∫Âñò‰∏çËøáÊ∞î„ÄÇ",
      "roast": "Âê¨Ëµ∑Êù•‰Ω†‰∏çÈúÄË¶ÅÈò≥ÂÖâÔºå‰Ω†ÈúÄË¶Å‰∏ÄÂè∞Èô§ÊπøÊú∫ÔºåË∞ÉËäÇ‰∏Ä‰∏ãÈÇ£ÊΩÆÊπøÁöÑÊÉÖÁª™„ÄÇ"
    },
    {
      "sentence": "ÊàëÊÑüÂà∞Êúâ‰∫õÊö¥È£éÈõ®Ëà¨ÁöÑÊÑ§ÊÄíÔºåÈöèÊó∂ÂèØËÉΩÁàÜÂèë„ÄÇ",
      "roast": "Âà´ÁîüÊ∞î‰∫ÜÔºåÂ∞èÂøÉ‰Ω†ÁöÑÊÑ§ÊÄíÂè™ÊòØ‰∏™Â∞èÈòµÈõ®ÔºåÁªìÊûúÊ≤°‰∫∫Ê≥®ÊÑèÂà∞„ÄÇ"
    },
    // Include all other roast pairs
  ]
};

function showToast(sentence, roast) {
  // Create toast container if it doesn't exist
  let container = document.querySelector('.toast-container');
  if (!container) {
    container = document.createElement('div');
    container.className = 'toast-container';
    document.body.appendChild(container);
  }

  // Create new toast
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.innerHTML = `
    <div class="toast-sentence">${sentence}</div>
    <div class="toast-roast">${roast}</div>
  `;

  // Add toast to container
  container.appendChild(toast);

  // Trigger animation
  setTimeout(() => {
    toast.classList.add('show');
  }, 100);

  // Remove toast after delay
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => {
      container.removeChild(toast);
    }, 300);
  }, 5000);
}

// Save tags function
async function saveTags() {
  const noteInput = document.getElementById('noteInput');
  const reportData = {
    temperature: parseFloat(document.querySelector('.temperature').textContent),
    location: document.querySelector('.location').textContent,
    description: document.querySelector('[data-i18n="sunny"]').textContent,
    userId: 1, // Replace with actual user ID
    tags: selectedTags,
    note: noteInput.value // Add the note to the saved data
  };
  
  await saveWeatherReport(reportData);

  // Get random roast
  const randomIndex = Math.floor(Math.random() * weatherInspiredRoasts.weather_inspired_roasts.length);
  const roastPair = weatherInspiredRoasts.weather_inspired_roasts[randomIndex];

  // Show success toast with roast
  showToast(noteInput.value || roastPair.sentence, roastPair.roast);
  
  hideModal();
}

// Initialize database on page load
window.addEventListener('load', async () => {
  await initDB();
  updateWeatherDetails(); // Call the function to generate weather details on page load
});

// Function to update weather details
function updateWeatherDetails() {
  // Generate three random numbers
  let total = 100;
  let stress = Math.floor(Math.random() * (total - 15)) + 5; // At least 5%
  total -= stress;
  
  let eating = Math.floor(Math.random() * (total - 10)) + 5; // At least 5%
  total -= eating;
  
  let activity = Math.floor(Math.random() * (total - 5)) + 5; // At least 5%
  total -= activity;
  
  // Last value is whatever remains to ensure total is 100
  let sleep = total;
  
  // Update the DOM
  document.querySelector('.detail-card:nth-child(1) .detail-value').textContent = stress + '%';
  document.querySelector('.detail-card:nth-child(2) .detail-value').textContent = eating + '%';
  document.querySelector('.detail-card:nth-child(3) .detail-value').textContent = activity + '%';
  document.querySelector('.detail-card:nth-child(4) .detail-value').textContent = sleep + '%';
}

// Language handling
let currentLanguage = 'en';

async function changeLanguage(lang) {
  if (!dbInitialized || !db) {
    console.error('Database not initialized');
    return;
  }

  try {
    currentLanguage = lang;
    const conn = await db.connect();
    
    await conn.query(`
      INSERT OR REPLACE INTO user_preferences (id, language)
      VALUES (1, '${lang}')
    `);
    
    const result = await conn.query(`
      SELECT key, value
      FROM translations
      WHERE lang = '${lang}'
    `);
    
    const translations = result.toArray();
    translations.forEach(([key, value]) => {
      const elements = document.querySelectorAll(`[data-i18n="${key}"]`);
      elements.forEach(el => el.textContent = value);
    });
    
    await conn.close();
  } catch (error) {
    console.error('Error changing language:', error);
  }
}

// Settings modal handling
const settingsModalOverlay = document.getElementById('settingsModalOverlay');
const closeSettingsModal = document.getElementById('closeSettingsModal');
const languageSelect = document.getElementById('languageSelect');

closeSettingsModal.onclick = () => {
  settingsModalOverlay.style.display = 'none';
};

languageSelect.onchange = async (e) => {
  await changeLanguage(e.target.value);
};

function setDay(day) {
  const container = document.getElementById('weatherContainer');
  container.classList.remove('monday', 'today', 'default');
  container.classList.add(day);
}

document.addEventListener('click', function(event) {
  const clickedElement = event.target;
  const forecastItems = document.querySelector('.forecast');
  if (!forecastItems.contains(clickedElement)) {
    setDay('today');
  }
});

let selectedTags = [];
let currentLevel = 0;

const addButton = document.getElementById('addButton');
const modalOverlay = document.getElementById('modalOverlay');
const closeModal = document.getElementById('closeModal');
const tagGroup = document.getElementById('tagGroup');
const breadcrumb = document.getElementById('breadcrumb');
const saveButton = document.getElementById('saveButton');

function showModal() {
  modalOverlay.style.display = 'flex';
  renderTags(Object.keys(tagHierarchy));
}

function hideModal() {
  modalOverlay.style.display = 'none';
  selectedTags = [];
  currentLevel = 0;
  updateBreadcrumb();
}

function renderTags(tags) {
  tagGroup.innerHTML = '';
  tags.forEach(tag => {
    const tagElement = document.createElement('div');
    tagElement.className = 'tag';
    tagElement.textContent = tag;
    tagElement.onclick = () => selectTag(tag);
    tagGroup.appendChild(tagElement);
  });
}

function updateBreadcrumb() {
  breadcrumb.innerHTML = '';
  selectedTags.forEach(tag => {
    const breadcrumbItem = document.createElement('div');
    breadcrumbItem.className = 'breadcrumb-item';
    breadcrumbItem.textContent = tag;
    breadcrumb.appendChild(breadcrumbItem);
  });
}

addButton.onclick = () => {
  showModal();
  setupVoiceRecording();
};

closeModal.onclick = hideModal;
saveButton.onclick = saveTags;

modalOverlay.onclick = (e) => {
  if (e.target === modalOverlay) {
    hideModal();
  }
};

let mediaRecorder;
let audioChunks = [];
let isRecording = false;

const recordButton = document.getElementById('recordButton');
const transcriptionArea = document.getElementById('transcriptionArea');

function toggleRecording() {
  if (!isRecording) {
    mediaRecorder.start();
    recordButton.classList.add('recording');
    recordButton.innerHTML = `
      <svg class="mic-icon" viewBox="0 0 24 24">
        <path fill="currentColor" d="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z"/>
      </svg>
      Stop Recording
    `;
  } else {
    mediaRecorder.stop();
    recordButton.classList.remove('recording');
    recordButton.innerHTML = `
      <svg class="mic-icon" viewBox="0 0 24 24">
        <path fill="currentColor" d="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z"/>
      </svg>
      Start Recording
    `;
  }
  isRecording = !isRecording;
}

const menuButton = document.getElementById('menuButton');
const menuModal = document.getElementById('menuModal');
const weatherContainer = document.querySelector('.content');
const radarPage = document.getElementById('radarPage');
const friendsPage = document.getElementById('friendsPage');
const reportsPage = document.getElementById('reportsPage');

let currentPage = 'weather';

menuButton.onclick = () => {
  menuModal.style.display = menuModal.style.display === 'block' ? 'none' : 'block';
};

document.addEventListener('click', (e) => {
  if (!menuButton.contains(e.target) && !menuModal.contains(e.target)) {
    menuModal.style.display = 'none';
  }
});

// Page navigation
document.querySelectorAll('.menu-item').forEach(item => {
  item.addEventListener('click', () => {
    const page = item.dataset.page;
    navigateToPage(page);
    menuModal.style.display = 'none';
  });
});

function navigateToPage(page) {
  const weatherContainer = document.querySelector('.content');
  const radarPage = document.getElementById('radarPage');
  const friendsPage = document.getElementById('friendsPage');
  const reportsPage = document.getElementById('reportsPage');
  const collectiblesPage = document.getElementById('collectiblesPage');
  
  weatherContainer.style.display = 'none';
  radarPage.style.display = 'none';
  friendsPage.style.display = 'none';
  reportsPage.style.display = 'none';
  collectiblesPage.style.display = 'none';
  
  switch(page) {
    case 'weather':
      weatherContainer.style.display = 'flex';
      break;
    case 'radar':
      radarPage.style.display = 'block';
      break;
    case 'friends':
      friendsPage.style.display = 'block';
      setTimeout(() => {
        initializeMap();
      }, 100);
      break;
    case 'report':
      reportsPage.style.display = 'block';
      setTimeout(() => {
        initializeStatisticsChart();
        initializeCalendar(); // Add this line
      }, 100);
      break;
    case 'collectibles':
      collectiblesPage.style.display = 'block';
      initializeCollectibles();
      break;
  }
}

function initializeStatisticsChart() {
  const chart = echarts.init(document.getElementById('statisticsChart'));
  
  const option = {
    backgroundColor: 'transparent',
    tooltip: {
      trigger: 'axis',
      axisPointer: {
        type: 'shadow'
      },
      formatter: function(params) {
        let tooltip = `${params[0].axisValue}Êúà<br/>`;
        params.forEach(param => {
          if (param.seriesName === 'Mood Score') {
            tooltip += `${param.seriesName}: ${param.value}/10<br/>`;
          } else {
            tooltip += `${param.seriesName}: ${param.value}%<br/>`;
          }
        });
        return tooltip;
      }
    },
    grid: {
      top: '10%',
      left: '5%',
      right: '5%',
      bottom: '25%',  // Increase bottom margin from 15% to 25% to create more space
      containLabel: true
    },
    xAxis: {
      type: 'category',
      data: Array.from({length: 12}, (_, i) => i + 1),
      axisLabel: {
        color: '#666',
        fontSize: 11,
        formatter: '{value}Êúà',
        margin: 16  // Add margin to increase space between labels and axis
      },
      axisLine: {
        lineStyle: {
          color: '#ddd'
        }
      },
      splitLine: {
        show: false
      }
    },
    yAxis: [
      {
        type: 'value',
        name: 'Score (%)',
        nameTextStyle: {
          color: '#666',
          fontSize: 11,
          padding: [0, 0, 0, 30]
        },
        min: 0,
        max: 100,
        position: 'left',
        axisLabel: {
          color: '#666',
          fontSize: 11,
          formatter: '{value}%'
        },
        axisLine: {
          show: false
        },
        splitLine: {
          lineStyle: {
            color: '#eee',
            type: 'dashed'
          }
        }
      },
      {
        type: 'value',
        name: 'Mood (1-10)',
        nameTextStyle: {
          color: '#666',
          fontSize: 11,
          padding: [0, 30, 0, 0]
        },
        min: 0,
        max: 10,
        position: 'right',
        axisLabel: {
          color: '#666',
          fontSize: 11
        },
        axisLine: {
          show: false
        },
        splitLine: {
          show: false
        }
      }
    ],
    series: [
      {
        name: 'Sleep Score',
        type: 'bar',
        stack: 'metrics',
        data: [25, 27, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20],
        itemStyle: {
          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
            { offset: 0, color: 'rgba(255, 149, 0, 0.8)' },
            { offset: 1, color: 'rgba(255, 149, 0, 0.3)' }
          ]),
          borderRadius: [3, 3, 0, 0]
        },
        emphasis: {
          itemStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
              { offset: 0, color: 'rgba(255, 149, 0, 1)' },
              { offset: 1, color: 'rgba(255, 149, 0, 0.5)' }
            ])
          }
        }
      },
      {
        name: 'Eating Score',
        type: 'bar',
        stack: 'metrics',
        data: [30, 25, 28, 25, 32, 30, 27, 29, 31, 26, 28, 24],
        itemStyle: {
          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
            { offset: 0, color: 'rgba(52, 199, 89, 0.8)' },
            { offset: 1, color: 'rgba(52, 199, 89, 0.3)' }
          ]),
          borderRadius: [3, 3, 0, 0]
        },
        emphasis: {
          itemStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
              { offset: 0, color: 'rgba(52, 199, 89, 1)' },
              { offset: 1, color: 'rgba(52, 199, 89, 0.5)' }
            ])
          }
        }
      },
      {
        name: 'Activity Level',
        type: 'bar',
        stack: 'metrics',
        data: [25, 28, 32, 35, 28, 30, 33, 31, 29, 34, 32, 36],
        itemStyle: {
          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
            { offset: 0, color: 'rgba(103, 58, 183, 0.8)' },
            { offset: 1, color: 'rgba(103, 58, 183, 0.3)' }
          ]),
          borderRadius: [3, 3, 0, 0]
        },
        emphasis: {
          itemStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
              { offset: 0, color: 'rgba(103, 58, 183, 1)' },
              { offset: 1, color: 'rgba(103, 58, 183, 0.5)' }
            ])
          }
        }
      },
      {
        name: 'Mood Score',
        type: 'line',
        smooth: true,
        yAxisIndex: 1,
        data: [7.2, 6.8, 7.5, 7.8, 7.3, 7.5, 7.6, 7.4, 7.2, 7.7, 7.4, 7.6],
        symbolSize: 6,
        lineStyle: {
          color: '#007AFF',
          width: 2
        },
        itemStyle: {
          color: '#007AFF',
          borderWidth: 2,
          borderColor: '#fff'
        }
      }
    ],
    legend: {
      bottom: 10,  // Adjust legend position to move it up slightly
      padding: [10, 10],  // Increase padding around legend
      itemGap: 15,
      itemWidth: 12,
      itemHeight: 12,
      textStyle: {
        color: '#666',
        fontSize: 11
      }
    }
  };

  chart.setOption(option);

  // Responsive handling
  const resizeObserver = new ResizeObserver(() => {
    chart.resize();
  });
  
  resizeObserver.observe(document.getElementById('statisticsChart'));

  // Cleanup on page change
  return () => {
    resizeObserver.disconnect();
    chart.dispose();
  };
}

// Initialize calendar function
function initializeCalendar() {
  const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
  let currentDate = new Date();
  let currentMonth = currentDate.getMonth();
  let currentYear = currentDate.getFullYear();

  function updateCalendar() {
    const firstDay = new Date(currentYear, currentMonth, 1).getDay();
    const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
    
    // Update calendar title
    document.querySelector('.calendar-title').textContent = `${months[currentMonth]} ${currentYear}`;
    
    // Clear existing calendar
    const calendarGrid = document.querySelector('.calendar-grid');
    calendarGrid.innerHTML = '';
    
    // Add empty cells for days before first of month
    for (let i = 0; i < firstDay; i++) {
      const emptyCell = document.createElement('div');
      emptyCell.className = 'calendar-cell empty';
      calendarGrid.appendChild(emptyCell);
    }
    
    // Add cells for each day of the month
    for (let day = 1; day <= daysInMonth; day++) {
      const cell = document.createElement('div');
      cell.className = 'calendar-cell';
      
      // Random mood data for demonstration
      const random = Math.random();
      if (random > 0.7) {
        cell.classList.add('high-mood');
      } else if (random < 0.3) {
        cell.classList.add('low-mood');
      } else {
        cell.classList.add('has-data');
      }
      
      cell.textContent = day;
      calendarGrid.appendChild(cell);
    }
  }

  // Add event listeners for calendar navigation
  document.querySelector('.prev-month').addEventListener('click', () => {
    currentMonth--;
    if (currentMonth < 0) {
      currentMonth = 11;
      currentYear--;
    }
    updateCalendar();
  });

  document.querySelector('.next-month').addEventListener('click', () => {
    currentMonth++;
    if (currentMonth > 11) {
      currentMonth = 0;
      currentYear++;
    }
    updateCalendar();
  });

  // Initialize calendar
  updateCalendar();
}

function initializeMap() {
  const map = L.map('reporterMap').setView([37.7749, -122.4194], 13);
  
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'OpenStreetMap contributors'
  }).addTo(map);

  const reporters = [
    { lat: 37.7749, lng: -122.4194, intensity: 0.8, reporter: "John D.", weather: "Sunny" },
    { lat: 37.7694, lng: -122.4862, intensity: 0.6, reporter: "Sarah M.", weather: "Cloudy" },
    { lat: 37.7858, lng: -122.4008, intensity: 0.9, reporter: "Mike R.", weather: "Clear" },
    { lat: 37.7840, lng: -122.4329, intensity: 0.7, reporter: "Emma L.", weather: "Partly Cloudy" }
  ];

  const heatmapConfig = {
    radius: 30,
    maxOpacity: 0.8,
    scaleRadius: false,
    useLocalExtrema: true,
    latField: 'lat',
    lngField: 'lng',
    valueField: 'intensity'
  };

  const heatmapLayer = new HeatmapOverlay(heatmapConfig);
  map.addLayer(heatmapLayer);

  heatmapLayer.setData({
    max: 1,
    data: reporters
  });

  reporters.forEach(reporter => {
    const marker = L.marker([reporter.lat, reporter.lng])
      .bindPopup(`
        <div style="padding: 10px;">
          <div style="font-weight: bold; margin-bottom: 5px;">${reporter.reporter}</div>
          <div>Weather: ${reporter.weather}</div>
        </div>
      `)
      .addTo(map);
      
    marker.on('mouseover', function (e) {
      this.openPopup();
    });
  });

  const legend = L.control({position: 'bottomleft'});
  legend.onAdd = function (map) {
    const div = L.DomUtil.create('div', 'map-overlay');
    div.innerHTML = `
      <div class="map-legend">
        <span class="legend-dot high"></span> High Activity
        <span class="legend-dot medium"></span> Medium Activity
        <span class="legend-dot low"></span> Low Activity
      </div>
    `;
    return div;
  };
  legend.addTo(map);

  const resizeObserver = new ResizeObserver(() => {
    map.invalidateSize();
  });
  resizeObserver.observe(document.getElementById('reporterMap'));

  return () => {
    resizeObserver.disconnect();
    map.remove();
  };
}

// Collectibles section
function initializeCollectibles() {
  // Initialize My Collection section with sample data
  const myCollection = [
    { name: 'Sunny Day', weather: 'sunny', preview: 'linear-gradient(135deg, #FFD700, #FFA500)' },
    { name: 'Rainy Mood', weather: 'rainy', preview: 'linear-gradient(135deg, #4A90E2, #357ABD)' },
    { name: 'Cloudy Blues', weather: 'cloudy', preview: 'linear-gradient(135deg, #B8C6DB, #8E9EAB)' },
    { name: 'Snow White', weather: 'snowy', preview: 'linear-gradient(135deg, #E8E8E8, #D1D1D1)' }
  ];

  // Initialize Theme Store with sample data
  const themeStore = [
    { name: 'Happy Sun', pack: 'Cartoon Pack', price: '200', preview: 'linear-gradient(135deg, #FFD700, #FFA500)' },
    { name: 'Rainy Cat', pack: 'Cartoon Pack', price: '200', preview: 'linear-gradient(135deg, #6983aa, #4A6B8A)' },
    { name: 'London Fog', pack: 'City Pack', price: '300', preview: 'linear-gradient(135deg, #808080, #3F3F3F)' },
    { name: 'Hawaii Beach', pack: 'City Pack', price: '300', preview: 'linear-gradient(135deg, #00C9FF, #92FE9D)' }
  ];

  // Render My Collection
  const myCollectionGrid = document.getElementById('myCollection');
  myCollectionGrid.innerHTML = myCollection.map(theme => `
    <div class="theme-card">
      <div class="theme-preview" style="background: ${theme.preview}"></div>
      <div class="theme-info">
        <div class="theme-name">${theme.name}</div>
        <div class="theme-weather">${theme.weather}</div>
      </div>
    </div>
  `).join('');

  // Render Theme Store
  const themeStoreGrid = document.getElementById('themeStore');
  themeStoreGrid.innerHTML = themeStore.map(theme => `
    <div class="theme-card">
      <div class="theme-preview" style="background: ${theme.preview}"></div>
      <div class="theme-info">
        <div class="theme-name">${theme.name}</div>
        <div class="theme-weather">
          <span style="color: #007AFF">${theme.price} coins</span>
        </div>
      </div>
    </div>
  `).join('');

  // Add weather filter functionality
  document.getElementById('weatherFilter').addEventListener('change', (e) => {
    const selectedWeather = e.target.value;
    const filteredThemes = selectedWeather === 'all' 
      ? myCollection 
      : myCollection.filter(theme => theme.weather === selectedWeather);
    
    myCollectionGrid.innerHTML = filteredThemes.map(theme => `
      <div class="theme-card">
        <div class="theme-preview" style="background: ${theme.preview}"></div>
        <div class="theme-info">
          <div class="theme-name">${theme.name}</div>
          <div class="theme-weather">${theme.weather}</div>
        </div>
      </div>
    `).join('');
  });

  // Add pack category functionality
  document.querySelectorAll('.pack-category').forEach(category => {
    category.addEventListener('click', () => {
      // Update active state
      document.querySelectorAll('.pack-category').forEach(c => c.classList.remove('active'));
      category.classList.add('active');
      
      // Filter themes based on pack
      const selectedPack = category.textContent;
      const filteredThemes = themeStore.filter(theme => theme.pack === selectedPack);
      
      themeStoreGrid.innerHTML = filteredThemes.map(theme => `
        <div class="theme-card">
          <div class="theme-preview" style="background: ${theme.preview}"></div>
          <div class="theme-info">
            <div class="theme-name">${theme.name}</div>
            <div class="theme-weather">
              <span style="color: #007AFF">${theme.price} coins</span>
            </div>
          </div>
        </div>
      `).join('');
    });
  });

  // Add subscribe button functionality
  document.querySelector('.subscribe-button').addEventListener('click', () => {
    alert('Subscription feature coming soon!');
  });

  // Add watch ads button functionality
  document.querySelector('.watch-ads-button').addEventListener('click', () => {
    alert('Ad feature coming soon! You will receive a random theme after watching.');
  });
}

// Add share functionality
const shareButton = document.getElementById('shareButton');
const shareModalOverlay = document.getElementById('shareModalOverlay');

shareButton.addEventListener('click', () => {
  updateSharePreview();
  shareModalOverlay.style.display = 'flex';
});

// Add click handler to close share modal when clicking outside
shareModalOverlay.addEventListener('click', (e) => {
  if (e.target === shareModalOverlay) {
    shareModalOverlay.style.display = 'none';
  }
});

// Add click handlers for share buttons
document.querySelector('.share-btn.sms').addEventListener('click', () => {
  // Check if the Web Share API is supported
  if (navigator.share) {
    navigator.share({
      title: 'Weather Report',
      text: `${document.querySelector('.temperature').textContent} - ${document.querySelector('.weather-description').textContent} in ${document.querySelector('.location').textContent}`,
      url: window.location.href
    })
    .catch((error) => console.log('Error sharing:', error));
  } else {
    // Fallback for SMS sharing
    const temperature = document.querySelector('.temperature').textContent;
    const location = document.querySelector('.location').textContent;
    const smsText = `Weather update: ${temperature} in ${location}`;
    window.location.href = `sms:?body=${encodeURIComponent(smsText)}`;
  }
  shareModalOverlay.style.display = 'none';
});

document.querySelector('.share-btn.social').addEventListener('click', () => {
  // Check if the Web Share API is supported
  if (navigator.share) {
    navigator.share({
      title: 'Weather Report',
      text: `${document.querySelector('.temperature').textContent} - ${document.querySelector('[data-i18n="sunny"]').textContent} in ${document.querySelector('.location').textContent}`,
      url: window.location.href
    })
    .catch((error) => console.log('Error sharing:', error));
  } else {
    // Fallback to clipboard copy
    const shareText = `${document.querySelector('.temperature').textContent} - ${document.querySelector('[data-i18n="sunny"]').textContent} in ${document.querySelector('.location').textContent}`;
    navigator.clipboard.writeText(shareText)
      .then(() => {
        alert('Share text copied to clipboard!');
      })
      .catch(err => {
        console.error('Failed to copy text:', err);
      });
  }
  shareModalOverlay.style.display = 'none';
});

// Update share preview content dynamically
function updateSharePreview() {
  const temperature = document.querySelector('.temperature').textContent;
  const location = document.querySelector('.location').textContent;
  const weather = document.querySelector('[data-i18n="sunny"]').textContent;
  
  document.querySelector('.share-preview-temp').textContent = temperature;
  document.querySelector('.share-preview-desc').textContent = `${weather} in ${location}`;
  
  // Generate a random roast from the weatherInspiredRoasts array
  const roasts = weatherInspiredRoasts.weather_inspired_roasts;
  const randomRoast = roasts[Math.floor(Math.random() * roasts.length)];
  document.querySelector('.share-preview-roast').textContent = randomRoast.roast;
}
</script>
</body></html>
